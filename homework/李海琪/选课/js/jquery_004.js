
;(function(a){a.bootui=a.bootui||{};a.bootui.widget=a.bootui.widget||{};a.bootui.widget.SearchBox=function(c,b){b.beforeRender.call(this,c);try{this.initialize.call(this,c,b)}catch(d){b.errorRender.call(this,d)}b.afterRender.call(this,c)};a.bootui.widget.SearchBox.prototype={constructor:a.bootui.widget.SearchBox,initialize:function(d,h){var k=this;var z=a.bootui.widget.messages.searchbox;var y=a.extend(true,{},h,{conditionList:[],condition_rows:{}});var e={filter:function(){var C=[];C.push('<div class="row search-filter ">');C.push('<div class="col-sm-12 col-md-12">');C.push('<div class="form-group form-group-sm"  style="margin-bottom:0px;">');C.push('<label for="" class="col-sm-2 col-md-2 control-label" >&nbsp;</label>');C.push('<div class="col-sm-8 col-md-8  buttons">');C.push('<div class="input-group">');if(a.founded(y.filterText)){C.push('<span class="input-group-addon"><label>'+y.filterText+"</label></span>")}C.push('<input type="text" value="" name="searchInput" class="form-control input-sm filter-input"  placeholder="'+z.placeholder+'">');C.push('<span class="input-group-btn">');C.push('<button class="btn btn-primary btn-sm" type="button" name="query"><i class=" bigger-110 icon-search"></i>&nbsp;'+z.queryButtonText+"</button>");C.push('<button class="btn btn-default btn-sm" type="button" name="reset"><i class=" bigger-110 icon-repeat"></i>&nbsp;'+z.resetButtonText+"</button>");C.push("</span>");C.push("</div>");C.push("</div>");C.push("</div>");C.push("</div>");if(a.founded(y.filters)){C.push('<div class="col-sm-12 col-md-12">');C.push('<div class="form-group form-group-sm"  style="margin-bottom:0px;">');C.push('<label for="" class="col-sm-2 col-md-2 control-label">&nbsp;</label>');C.push('<div class=" col-sm-8 col-md-8 types">');C.push('<label class="radio-inline"><input checked="checked" value="all" name="searchFilter" type="radio">'+z.allRadioText+"&nbsp;&nbsp;</label>");C.push("</div>");C.push("</div>");C.push("</div>")}C.push("</div>");return C.join("")},filterRadio:function(C,D){return'<label class="radio-inline"><input value="'+C+'" name="searchFilter" type="radio"/>'+D+"&nbsp;&nbsp;</label>"},selected:function(){return'<div class="row selected-attr"><div class="col-sm-12 col-md-12"><div class="form-group form-group-sm" style="margin-bottom:5px;"><label for="" class="col-sm-2 col-md-2 control-label">'+z.seletedLabelText+'\uff1a</label><div class="col-sm-9 col-md-9 selecteds"></div></div></div></div>'},condition_item:'<div class="row condition-item"></div>',condition_row:function(D,C){return'<div class="col-sm-12 col-md-12 condition-row"><div class="form-group form-group-sm" style="margin-bottom:5px;"><label for="" class="col-sm-2 col-md-2 control-label title">'+D.text+'\uff1a</label><div class="col-sm-9 col-md-9 items" name="'+D.index+'"><ul>'+C+"</ul></div></div></div>"},query_row:function(C){return'<div class="row query-item "><div class="col-sm-12 col-md-12"><div class="form-group form-group-sm pull-right"  style="margin-bottom:0px;"><div class="col-sm-12 col-md-12  buttons"><div class="btn-group"><button class="btn btn-primary btn-sm" type="button" name="query"><i class=" bigger-110 icon-search"></i>&nbsp;'+z.queryButtonText+'</button><button class="btn btn-default btn-sm" type="button" name="reset"><i class=" bigger-110 icon-repeat"></i>&nbsp;'+z.resetButtonText+"</button></div></div></div></div></div>"},fixed:function(C){return'<li class="col-sm-12 col-md-12"  name="fixed" index="'+C+'"><div class="input-group input-group-xs"><input type="text" value="" class="form-control pull-left input-xs input-xs-last fixed"/><span class="input-group-btn pull-left"><button class="btn btn-default btn-xs sure" type="button">'+z.sureButtonText+"</button></span></div></li>"},range:function(C){var D=(C.type||"string").toLowerCase();var F="",E="",G="";if(D=="time"){F=' readonly="readonly" '}else{if(D=="integer"){G=' style = "ime-mode:disabled " ';E=" onkeyup=\"this.value=this.value.replace(/[^\\d]/g,'')\" onbeforepaste=\"clipboardData.setData('text',clipboardData.getData('text').replace(/[^\\d]/g,''))\" "}else{if(D=="number"){}}}return'<li class="col-sm-12 col-md-12" name="range" index="'+C.index+'"><div class="input-group input-group-xs"><input type="text" value="" class="form-control pull-left input-xs range '+D+'"  '+F+G+E+'/><span class="pull-left" style="line-height: 16px;padding: 2px;">'+z.toLabelText+'</span><input type="text" value="" class="form-control pull-left input-xs input-xs-last range '+D+'"  '+F+G+E+'/><span class="input-group-btn pull-left"><button class="btn btn-default btn-xs sure" type="button">'+z.sureButtonText+"</button></span></div></li>"},items:function(D){var C=a.founded(D.attr)?(a.isFunction(D.attr)?D.attr.call(this,D):D.attr):"";var E=[];a.each(D.items||[],function(F,G){var H=(D.index||"")+"_"+G.key;E.push('<li class="col-sm-1 col-md-1" name="'+(G.moreEvent||"fixed")+'" index="'+H+'" >');E.push('<a href="javascript:void(0);" '+C+(G.checked?' class="selectedValue" ':"")+">"+G.text+"</a>");E.push("</li>")});return E.join("")},select:function(E,D){var F=D.index,C=D.multiple||"";var G=['<li class="col-sm-12 col-md-12"  name="select" index="'+F+'">'];G.push('<div class="input-group select-group-xs">');G.push('<select class="form-control pull-left select-xs single-select" '+(a.founded(C)?(' data-multiple="'+C+'"'):"")+">");G.push('<option value=""  index="'+(F||"")+'_all" >'+z.allSelectText+"</option>");a.each(E||[],function(H,I){var J=(F||"")+"_"+I.key;G.push('<option value="'+I.key+'"  index="'+J+'" '+(I.selected?' selected="selected" ':"")+">"+I.text+"</option>")});G.push("</select></div></li>");return G.join("")},dualSelect:function(C,E,F){var D=['<li class="col-sm-12 col-md-12"  name="dualSelect" index="'+C+'">'];D.push('<div class="input-group select-group-xs">');D.push('<select class="form-control pull-left select-xs dual-select" >');D.push('<option value="">'+z.allSelectText+"</option>");a.each(E||[],function(G,H){D.push('<option value="'+H.key+'" '+(H.selected?' selected="selected" ':"")+">"+H.text+"</option>")});D.push("</select>");D.push('<span class="pull-left" style="line-height: 16px;padding: 2px;">'+z.toLabelText+"</span>");D.push('<select class="form-control pull-left select-xs select-xs-last " >');D.push('<option value="">'+z.allSelectText+"</option>");a.each(F||[],function(G,H){D.push('<option value="'+H.key+'"  '+(H.selected?' selected="selected" ':"")+">"+H.text+"</option>")});D.push("</select>");D.push('<span class="input-group-btn pull-left"><button class="btn btn-default btn-xs sure" type="button">'+z.sureButtonText+"</button></span>");D.push("</div>");D.push("</li>");return D.join("")},radio:function(D,C){var E=['<li class="col-sm-12 col-md-12"  name="radio" index="'+D+'">','<div class="input-group input-group-xs">'];a.each(C||[],function(F,G){var H=(D||"")+"_"+G.key;var I=(D||"")+"_radio";E.push('<label class="radio-inline radio-inline-xs">');E.push('<input class="form-control pull-left radio-xs" value="'+G.key+'" name="'+I+'" index="'+H+'" '+(G.checked?' checked="checked" ':"")+' type="radio"/>'+G.text+"&nbsp;&nbsp;");E.push("</label>")});E.push("</div></li>");return E.join("")},checkbox:function(D,C){var E=['<li class="col-sm-12 col-md-12"  name="checkbox" index="'+D+'">','<div class="input-group input-group-xs">'];a.each(C||[],function(F,G){var H=(D||"")+"_"+G.key;var I=(D||"")+"_checkbox";E.push('<label class="checkbox-inline checkbox-inline-xs">');E.push('<input class="form-control pull-left checkbox-xs" value="'+G.key+'" name="'+I+'" index="'+H+'" '+(G.checked?' checked="checked" ':"")+' type="checkbox"/>'+G.text+"&nbsp;&nbsp;");E.push("</label>")});E.push("</div></li>");return E.join("")},more:function(C){return'<div class="col-sm-1 col-md-1 more" index="'+C.index+'"><a href="javascript:void(0);" class="more_up" style="display: block;">&nbsp;'+z.downLabelText+" </a></div>"},condition_retract:function(){return'<div class="col-sm-12 col-md-12 condition-retract"><p><a class="up" href="javascript:void(0);">'+z.moreItemUpText+"</a></p></div>"}};var A={searchResult:function(){y.onSearchClick.call(k,k.getConditions(),k.getMergeConditions())},resetConditions:function(){if(b.size()>0){a(b).find("div.buttons").find("input[name=searchInput]").val("");if(a(b).find("input.filter-input").size()>0){a(b).find("div.types").find(":radio:eq(0)").click()}}a(B).find("div.selecteds").empty();if(q.size()>0){a(q).find(":text").val("");a(q).find("div.items a").removeClass("selectedValue")}a.each(y.model,function(D,C){var E=[];a.each(C.items||[],function(H,G){G.checked=false;var I=(C.index||"")+"_"+G.key;a.each(y.conditionList||[],function(J,K){if(K.indexStr==I){E.push(G);return false}})});if(E.length>0){k.removeSelectedItem(C,E)}var F=a(y.condition_rows[C.index]).find("ul:eq(0)");if(a.defined(C.select)&&a.toBoolean(C.select)){a(F).find("select.select-xs").val("")}else{if(a.defined(C.dualSelect)&&a.toBoolean(C.dualSelect)){a(F).find("select.select-xs").each(function(){a(this).data("initialized",false);a(this).data("requestMap",{});a(this).val("")})}else{if(a.defined(C.radio)&&a.toBoolean(C.radio)){a(F).find(":radio").removeAttr("checked")}else{if(a.defined(C.checkbox)&&a.toBoolean(C.checkbox)){a(F).find(":checkbox").removeAttr("checked")}}}}});y.conditionList=[];if(y.autoSearch){y.onSearchClick.call(k,k.getConditions(),k.getMergeConditions())}}};a.extend(k,{buildItem:function(C,E,G,D){var F=(C.index||"")+"_"+E;return a.extend(true,D||{},{index:F,key:E,text:G})},addSelectedItem:function(E,D){var F=a(B).find("div.selecteds");var I=a(y.condition_rows[E.index]).find("ul:eq(0)");var H=[];if(a.isArray(D)){H=jQuery.merge(H,D)}else{H=[D]}var C=E.multiple;var G=false;a.each(H||[],function(K,J){J.checked=true;J.keyIndex=E.index;J.indexStr=(E.index||"")+"_"+J.key;if(!C){a(F).find("div.selected[index*='"+E.index+"']").each(function(O,N){var P=a(this).attr("index");var M=a.grep(y.conditionList||[],function(Q,R){return P==Q.indexStr});k.removeSelectedItem(E,M)})}if(!J.isDefault){x(E,J)}if(!s(y.conditionList,J)){G=true;y.conditionList.push(J);a(F).append('<div class="col-sm-12 col-md-2 selected" index="'+J.indexStr+'"><a index="'+J.indexStr+'" key="'+J.key+'" href="javascript:void(0);">'+E.text+":"+J.text+'<span class="close-icon"></span></a></div>');var L=a(I).find("li[index='"+J.indexStr+"']").find("a:eq(0)");a(L).addClass("selectedValue");a(F).find("div[index='"+J.indexStr+"']").find("span.close-icon").unbind().click(function(N){N.stopPropagation();var M=a(this).parent().parent().attr("index");var O=undefined;a.each(y.conditionList||[],function(Q,P){if(P.indexStr==M){O=P;return false}});k.removeSelectedItem(E,O);return false});a(B).show()}});if(G){j(E);if(y.autoSearch){y.onSearchClick.call(k,k.getConditions(),k.getMergeConditions())}}},removeSelectedItem:function(D,C){k.removeSelectedItemImp(D,C);window.setTimeout(n,100)},removeSelectedItemImp:function(E,D){if(a.founded(D)){var I=a(y.condition_rows[E.index]).find("ul:eq(0)");var F=a(B).find("div:eq(0)");var H=[];if(a.isArray(D)){H=jQuery.merge(H,D)}else{H=[D]}var G=false;var C=[];a.each(H||[],function(K,J){var L=(E.index||"")+"_"+J.key;J.removed=true;y.conditionList=jQuery.grep(y.conditionList||[],function(O,N){if(O.indexStr==L){G=true;return false}else{return true}});var M=a(I).find("li[index='"+L+"']").find("a:eq(0)");a(M).removeAttr("class");a(M).removeClass("selectedValue");a(F).find("div[index='"+L+"']").remove();if(a(F).find("div.selected").size()==0){a(F).parent().hide()}});if(G){j(E);if(y.autoSearch){y.onSearchClick.call(k,k.getConditions(),k.getMergeConditions())}}}},getConditions:function(){var E={};var C=(y.conditionList||[]).sort(function(H,G){return H.index.localeCompare(G.index)});a.each(y.model,function(I,G){var H=0;a.each(C,function(J,K){if(K.keyIndex==G.index){E[G.index+"["+H+"]"]=K.key;H+=1}})});if(b.size()>0){var D=a(b).find("div.buttons").find("input[name='searchInput']").val();var F=[];if(a.founded(D)){a.each(D.split(" ")||[],function(G,H){if(a.founded(a.trim(H))){F.push(H)}})}if(F.length>0){if(a(b).find("input.filter-input").size()>0){E.filterKey=a(b).find("div.types").find("input[name='searchFilter']:checked").val()}a.each(F,function(G,H){E["filter_list["+G+"]"]=H})}}return E},getMergeConditions:function(){var E={};var C=(y.conditionList||[]).sort(function(H,G){return H.index.localeCompare(G.index)});a.each(y.model,function(H,G){a.each(C,function(I,J){if(J.keyIndex==G.index){if(!E[G.index]){E[G.index]=[]}E[G.index].push(J.key)}})});if(b.size()>0){var D=a(b).find("div.buttons").find("input[name='searchInput']").val();var F=[];if(a.founded(D)){a.each(D.split(" ")||[],function(G,H){if(a.founded(a.trim(H))){F.push(H)}})}if(F.length>0){if(a(b).find("input.filter-input").size()>0){E.filterKey=a(b).find("div.types").find("input[name='searchFilter']:checked").val()}E.filter_list=[];a.each(F,function(G,H){E.filter_list.push(H)})}}a.each(E,function(G,H){if(a.isArray(H)){E[G]=H.join(",")}});return E}},A);a.each(A,function(C,D){a(d).bind(C,D)});function w(C){var D=new Array();D.push('<div class="form-horizontal sl_all_form searchbox" style="display: block;border: 0px;">');if(a.defined(C.searchFilter)&&a.toBoolean(C.searchFilter)){D.push("<!-- fuzzy search -->");D.push(e.filter.call(k));D.push("<!-- fuzzy search end-->")}else{D.push("<!-- search query-->");D.push(e.query_row.call(k));D.push("<!-- search query end-->")}if(a.toBoolean(C.selectedAttr)){D.push("<!-- selected conditions -->");D.push(e.selected.call(k));D.push("<!-- selected conditions end-->")}if(a.defined(C.model)&&C.model.length>0){D.push("<!-- advanced query-->");D.push(e.condition_item);D.push("<!-- advanced query end-->")}D.push("</div>");return D.join("")}function s(C,D){var E=false;a.each(C||[],function(F,G){if(G.index==D.index&&G.key==D.key){E=true;return false}else{E=false}});return E}function x(C,D){if(!s(C.items,D)){C.items.push(D)}}function m(C,E){var D=null;a.each(C.items||[],function(F,G){if(G.index==E){D=G;return false}});return D}function i(E,D){var C=[];a.each(D||[],function(G,F){x(E,F)});if(a.founded(E.defaults)){a.each(E.defaults||[],function(G,F){a.each(E.items,function(H,I){F.isDefault=true;F.index=(E.index||"")+"_"+F.key;if(I.key==F.key){F.isHave=true;F.checked=true;I.checked=true;I.isDefault=true;k.addSelectedItem(E,I);return false}})})}return e.items.call(k,E)}function n(){a.each(a(".condition-row"),function(D,C){if(a(C).find("ul:eq(0)").find("li").size()>0){a(C).find("div.more a").show()}else{a(C).find("div.more a").hide()}})}function j(C){var D=[];a.each(y.model,function(E,F){if(C.index!=F.index&&a.defined(F.parent)){if(a.isArray(F.parent)){a.each(F.parent,function(G,H){if(a.trim(C.index)==a.trim(H)){D.push(F);return false}})}else{if(a.trim(C.index)==a.trim(F.parent)){D.push(F)}}}});if(D.length>0){a.each(D,function(E,H){var G={};var I=[];if(a.isArray(H.parent)){a.each(H.parent,function(J,K){I.push(K)})}else{I.push(H.parent)}a.each(I||[],function(J,L){var K=0;a.each(y.conditionList||[],function(M,N){if(N.keyIndex==L){G[L+"["+K+"]"]=N.key;K+=1}})});var F=a(q).find("div[name='"+H.index+"']");if(a.founded(H.url)&&a.founded(H.mapper)){c.call(F,H.url,F,H,G,function(){v(F,H)}).always(function(){})}else{if(a.defined(C.dualSelect)&&a.toBoolean(C.dualSelect)){a(F).find("ul:eq(0)").find("select.select-xs").each(function(){a(this).data("initialized",false);a(this).data("requestMap",G);a(this).val("")})}}})}}function o(C){var E={};if(a.defined(C.parent)){var D=[];a.each(y.model,function(F,G){if(C.index!=G.index){if(a.isArray(C.parent)){a.each(C.parent,function(H,I){if(a.trim(G.index)==a.trim(I)){D.push(G);return false}})}else{if(a.trim(C.parent)==a.trim(G.index)){D.push(G)}}}});if(D.length>0){a.each(D,function(F,I){var G=0,H=I.index;a.each(y.conditionList||[],function(J,K){if(K.keyIndex==H){E[H+"["+G+"]"]=K.key;G+=1}})})}}return E}function v(E,D){if(a.founded(D.defaults)){var F=a(E).find("ul:eq(0)");var C=a.founded(D.attr)?(a.isFunction(D.attr)?D.attr.call(k,D):D.attr):"";a.each(D.defaults||[],function(H,G){if(!G.isHave){var I=(D.index||"")+"_"+G.key;var J='<a href="javascript:void(0);" '+C+' class="selectedValue" >'+G.text+"</a>";a(F).prepend('<li class="col-sm-12 col-md-1" name="defalut" index="'+I+'" >'+J+"</li>");k.addSelectedItem(D,G)}});a(F).find("li[name='defalut']").each(function(H){var G=D.defaults[H];a(this).find("a:eq(0)").unbind().click(G,function(I){I.stopPropagation();a(this).addClass("selectedValue");k.addSelectedItem(D,I.data)})})}}function r(J,H,D){var G=a(H).find("option:selected");if(a(G).founded()){var I=k.buildItem(J,a(G).val(),a(G).text());var K=a(H).data("multiple")||false;if(a.founded(K)&&(K=="multiple"||K=="true"||K==true)){k.removeSelectedItem(J,I);k.addSelectedItem(J,I)}else{var C=a(H).data("preIndex");if(a.founded(C)){var E=a(H).find("option[index='"+C+"']");if(a(E).defined()){var F=k.buildItem(J,a(E).val(),a(E).text());k.removeSelectedItem(J,F)}}a(H).data("preIndex",I.key);k.addSelectedItem(J,I)}}}function p(D,G,I,F){var H=a(G).find("option:selected");var C=a(I).find("option:selected");if(a(H).founded()&&a(C).founded()){a(G).find("option").each(function(){var J=this;if(a(this).founded()){a(I).find("option").each(function(){if(a(this).founded()){var K=k.buildItem(D,(a(J).val()+"||"+a(this).val()),(a(J).text()+"~"+a(this).text()));k.removeSelectedItem(D,K)}})}});var E=k.buildItem(D,(a(H).val()+"||"+a(C).val()),(a(H).text()+"~"+a(C).text()));k.removeSelectedItem(D,E);k.addSelectedItem(D,E)}}function u(C,D){var E=a(D).find(":radio");a(E).each(function(){var F=k.buildItem(C,a(this).val(),a(this)[0].nextSibling.nodeValue);if(a(this).prop("checked")){k.removeSelectedItem(C,F);k.addSelectedItem(C,F)}else{k.removeSelectedItem(C,F)}})}function g(D,E){var C=a(E).find(":checkbox");a(C).each(function(){var F=k.buildItem(D,a(this).val(),a(this)[0].nextSibling.nodeValue);if(a(this).prop("checked")){k.removeSelectedItem(D,F);k.addSelectedItem(D,F)}else{k.removeSelectedItem(D,F)}})}function t(F,E,C){var D=this;var G=a(D).data("initialized");if((!a.defined(G)||!a.toBoolean(G))&&a.founded(F)){c.call(D,F,E,C,a(D).data("requestMap")||{},function(){v(E,C)}).always(function(){if(a.defined(C.dualSelect)&&a.toBoolean(C.dualSelect)){if(a.founded(C.url)){a(E).find("ul:eq(0)").find("select.select-xs").each(function(){a(this).data("initialized",true)})}}else{a(D).data("initialized",true)}})}}function f(E,D){y.condition_rows[D.index]=E;var H=a(E).find("ul:eq(0)");if(a.defined(D.select)&&a.toBoolean(D.select)){a(H).find("select.select-xs").unbind().change(function(I){r(D,this,H)})}else{if(a.defined(D.dualSelect)&&a.toBoolean(D.dualSelect)){var F=a(H).find("select.select-xs");a(F[0]).unbind().click(function(J){var I=a.founded(D.url)?D.url:D.leftURL;t.call(this,I,E,D)});a(F[1]).unbind().click(function(J){var I=a.founded(D.url)?D.url:D.rightURL;t.call(this,I,E,D)});a(H).find("button.sure").unbind().click(function(I){p(D,F[0],F[1],H)})}else{if(a.defined(D.radio)&&a.toBoolean(D.radio)){a(H).find(":radio").unbind().change(function(I){u(D,H)})}else{if(a.defined(D.checkbox)&&a.toBoolean(D.checkbox)){a(H).find(":checkbox").unbind().click(function(I){g(D,H)})}else{if(a.defined(D.range)&&a.toBoolean(D.range)){var C=a(H).find("input[type='text']");var G=(D.type||"string").toLowerCase();if(G=="integer"){a(C).off("keydown.widget.data-api").on("keydown.widget.data-api",function(J){var I=a.event.fix(J);if((!(I.keyCode==46)&&!(I.keyCode==8)&&!(I.keyCode==37)&&!(I.keyCode==39))&&(!((I.keyCode>=48&&I.keyCode<=57)||(I.keyCode>=96&&I.keyCode<=105)))){I.stopPropagation();I.preventDefault();I.returnValue=false}})}else{if(G=="number"){a(C).off("keyup.widget.data-api").on("keyup.widget.data-api",function(L){var J=a.trim(this.value);if(J.length>0&&isNaN(J)){this.value=J.replace(/[^\d|.]/g,"")||"";this.value=J.replace(/\.+/g,".")||"";var I=J.indexOf(".");if(I==0){this.value="0"+J}if(I>0){var K=J.substring(J.indexOf("."),J.length);if(a.trim(K).length>0){var M=J.lastIndexOf(".");if(I!=M){this.value=J.substr(0,M)}}}}}).off("blur.widget.data-api").on("blur.widget.data-api",function(K){var J=a.trim(this.value);if(J.length>0&&isNaN(J)){var I=J.indexOf(".");if(I==(J.length-1)){this.value=J.substr(0,I)}this.value=Number(this.value)}})}}}a(H).find("li[name='fixed'],li[name='append']").each(function(J){var I=D.items[J];a(this).find("a:eq(0)").unbind().click(I||{},function(K){K.stopPropagation();a(this).addClass("selectedValue");k.addSelectedItem(D,K.data);window.setTimeout(function(){n()},100)})});a(H).find("input[type=text]").each(function(J,I){a.each(D.events||{},function(K,L){a(I).unbind(K).bind(K,L)})});a(H).find("button.sure").unbind().click(function(L){L.stopPropagation();var J=a(this).closest("li[name='fixed'],li[name='range']");var I=a(J).find(":text");if(I.size()==2&&a.founded(a(I[0]).val())&&a.founded(a(I[1]).val())){var K=k.buildItem(D,(a(I[0]).val()+"||"+a(I[1]).val()),(a(I[0]).val()+"~"+a(I[1]).val()));k.addSelectedItem(D,K)}else{if(I.size()==1&&a.founded(a(I[0]).val())){var K=k.buildItem(D,a(I[0]).val(),a(I[0]).val());k.addSelectedItem(D,K)}}})}}}}a(E).find("div.more a").unbind().click(function(K){K.stopPropagation();var O=this;var J=a(O).attr("index");var N=D.showSize||y.showSize;if(a(O).hasClass("more_up")){if(a.founded(D.url)&&D.local){var I=[];a.each(D.localItems,function(Q,P){if(Q>=N){P.moreEvent="append";I.push(P)}});a(E).find("ul:eq(0)").empty().append(i(D,I));a(O).removeClass("more_up").addClass("more_down");a(O).html("&nbsp;"+z.upLabelText)}else{if(a.founded(D.url)&&a.founded(D.mapper)){var M=D.mapper;var L={};L=a.extend(L,o(D));L[y.paramNames.order||"queryModel.sortOrder"]=D.order;L[y.paramNames.sort||"queryModel.sortName"]=D.sort;L.checked=function(){var P=[];a.each(y.conditionList||[],function(R,Q){if(Q.indexStr&&Q.indexStr.indexOf(D.index)==0){P.push(Q)}});return P}.call(this);L.rangeable=D.rangeable;L.items=[];L.localItems=[];if(D.moreEvent=="dialog"){a.extend(L,D);L[y.paramNames.page||"queryModel.currentPage"]=0;L[y.paramNames.rows||"queryModel.showCount"]=-1;y.onMoreClick.call(k,D,L)}else{if(D.moreEvent=="append"){a(O).removeClass("more_up").addClass("more_down");a(O).html("&nbsp;"+z.upLabelText);if(a(E).find("ul:eq(0)").find("li[name=append]").size()==0){L[y.paramNames.page||"queryModel.currentPage"]="1";L[y.paramNames.rows||"queryModel.showCount"]=y.maxSize;L[y.paramNames.minNum||"minNum"]=N;L[y.paramNames.maxNum||"maxNum"]=y.maxSize;jQuery.ajaxSetup({async:false});a.post(D.url,L,function(Q){var P=[];if(a.defined(Q)){if(a.isArray(Q)){a.each(Q||[],function(U,S){var T=S[M.key],V=S[M.text];var R=k.buildItem(D,T,V,S);R.moreEvent="append";P.push(R)})}else{a.each(Q[y.jsonReader.root]||[],function(U,S){var T=S[M.key],V=S[M.text];var R=k.buildItem(D,T,V,S);R.moreEvent="append";P.push(R)})}a(E).find("ul:eq(0)").empty().append(i(D,P));f(E,D)}},"json");jQuery.ajaxSetup({async:true})}else{a(E).find("ul:eq(0)").find("li[name='append']").show()}}}}else{a(O).removeClass("more_up").addClass("more_down");a(O).html("&nbsp;"+z.upLabelText);if(a(E).find("ul:eq(0)").find("li[name='append']").size()==0){if(a.defined(D.options)&&a.isArray(D.options)){var I=[];a.each(D.options,function(Q,P){if(Q>=N){a.each(P,function(S,T){var R=k.buildItem(D,S,T);R.moreEvent="append";I.push(R);return false})}});a(E).find("ul:eq(0)").empty().append(i(D,I))}else{if(a.defined(D.range)&&a.toBoolean(D.range)){var I=[];a.each(D.rangeItems||[],function(R,P){if(R>=N){var Q=k.buildItem(D,(P[0]+"||"+P[1]),(P[0]+"~"+P[1]));Q.moreEvent="append";I.push(Q)}});a(E).find("ul:eq(0)").empty().append(i(D,I))}}f(E,D)}else{a(E).find("ul:eq(0)").find("li[name='append']").show()}}}a(O).parent().prev("div").find("a").each(function(Q,P){a(P).unbind().click(function(S){S.stopPropagation();a(this).addClass("selectedValue");var R=m(D,a(this).parent().attr("index"));k.addSelectedItem(D,R);a(B).show()})})}else{a(E).find("ul:eq(0)").find("li[name=append]").hide();a(O).removeClass("more_down").addClass("more_up");a(O).html("&nbsp;"+z.downLabelText)}})}function c(F,G,K,J,D){var H=this;var C=K.mapper;var I=K.showSize||y.showSize;var E={};E[y.paramNames.page||"queryModel.currentPage"]="1";E[y.paramNames.rows||"queryModel.showCount"]=I;E[y.paramNames.minNum||"minNum"]=0;E[y.paramNames.maxNum||"maxNum"]=I;E[y.paramNames.order||"queryModel.sortOrder"]=K.order;E[y.paramNames.sort||"queryModel.sortName"]=K.sort;E.rangeable=K.rangeable;a.extend(true,E,K.data||{},J);K.more=false;K.items=[];K.localItems=[];return a.post(F,E,function(P){var M=[];if(a.defined(P)){var L=0;if(a.isArray(P)){L=P.length;a.each(P||[],function(T,R){var S=R[C.key],U=R[C.text];K.localItems.push(k.buildItem(K,S,U,R))});K.moreEvent="append";K.local=true}else{a.each(P[y.jsonReader.root],function(T,R){var S=R[C.key],U=R[C.text];K.localItems.push(k.buildItem(K,S,U,R))});L=P[y.jsonReader.records]||K.localItems.length;if(L>(I*3)){K.moreEvent="dialog"}else{K.moreEvent="append"}}var Q=a(G).find("ul:eq(0)");if(a.defined(K.select)&&a.toBoolean(K.select)){a(Q).empty().append(e.select.call(this,K.localItems,K));r(K,a(Q).find("select.select-xs"),Q)}else{if(a.defined(K.dualSelect)&&a.toBoolean(K.dualSelect)){var O=a(Q).find("select.select-xs");var N=['<option value=""  index="'+(K.index||"")+'_all" >'+z.allSelectText+"</option>"];a.each(K.localItems||[],function(R,S){N.push('<option value="'+S.key+'" '+(S.selected?' selected="selected" ':"")+">"+S.text+"</option>")});if(a.founded(K.url)){a(O[0]).empty().append(N.join(""));a(O[1]).empty().append(N.join(""))}else{if(F==K.leftURL&&a(H).is(O[0])){a(O[0]).empty().append(N.join(""))}else{if(F==K.rightURL&&a(H).is(O[1])){a(O[1]).empty().append(N.join(""))}}}p(K,O[0],O[1],Q)}else{if(a.defined(K.radio)&&a.toBoolean(K.radio)){a(Q).empty().append(e.radio.call(this,K.index,K.localItems));u(K,Q)}else{if(a.defined(K.checkbox)&&a.toBoolean(K.checkbox)){a(Q).empty().append(e.checkbox.call(this,K.index,K.localItems));g(K,Q)}else{a.each(K.localItems,function(S,R){if(S<I){M.push(R)}});a(Q).empty().append(i(K,M));a(G).find("div.more").remove();if(L>I){K.more=true;a(G).find("div.form-group").append(e.more.call(k,K))}}}}}f(G,K);if(jQuery.isFunction(D)){D.call(k)}}if(!a.toBoolean(K.hidden)&&(a.founded(M)||a(G).find("ul:eq(0)").find("li").size()>0)){a(G).show()}else{a(G).hide()}},"json")}a(d).empty().append(w(y));var b=a(d).find("div.search-filter:eq(0)");var l=a(d).find("div.query-item:eq(0)");var B=a(d).find("div.selected-attr:eq(0)");var q=a(d).find("div.condition-item:eq(0)");a.when(a.Deferred(function(C){if(b.size()>0&&a.founded(y.filters)){a.each(y.filters||[],function(F,E){a.each(E,function(G,H){a(b).find("div.types").append(e.filterRadio(G,H));return false})})}if(q.size()>0){a(q).empty();var D=[];a.each(y.model,function(H,F){a.extend(true,F,{moreEvent:a.defined(F.moreEvent)?F.moreEvent:"append",multiple:a.defined(F.multiple)?a.toBoolean(F.multiple):true,rangeable:a.defined(F.rangeable)?a.toBoolean(F.rangeable):true,items:[],defaults:F.defaults||[],showSize:F.showSize||y.showSize,order:(a.type(F.order)=="string"?F.order:""),sort:(a.type(F.sort)=="string"?F.sort:"")});var J=F.showSize;var I=new Array();if(a.defined(F.options)&&a.isArray(F.options)){var E=[];a.each(F.options,function(L,K){a.each(K,function(N,O){var M=k.buildItem(F,N,O);if(L<J){E.push(M)}return false})});I.push(i(F,E))}else{if(a.defined(F.range)&&a.toBoolean(F.range)){if(a.founded(F.rangeItems)){var E=[];a.each(F.rangeItems||[],function(M,K){var L=k.buildItem(F,(K[0]+"||"+K[1]),(K[0]+"~"+K[1]));if(M<J){E.push(L)}});I.push(i(F,E))}else{I.push(e.range.call(this,F))}}else{if(a.defined(F.fixed)&&a.toBoolean(F.fixed)){I.push(e.fixed.call(this,F.index))}else{if(a.defined(F.select)&&a.toBoolean(F.select)){I.push(e.select.call(this,F.items,F))}else{if(a.defined(F.dualSelect)&&a.toBoolean(F.dualSelect)){I.push(e.dualSelect.call(this,F.index,F.leftItems,F.rightItems))}else{if(a.defined(F.radio)&&a.toBoolean(F.radio)){I.push(e.radio.call(this,F.index,F.items))}else{if(a.defined(F.checkbox)&&a.toBoolean(F.checkbox)){I.push(e.checkbox.call(this,F.index,F.items))}}}}}}}a(q).append(e.condition_row.call(this,F,I.join("")));var G=a(q).find("div.condition-row").eq(H);y.condition_rows[F.index]=G;D.push(a.Deferred(function(L){if(a.founded(F.url)&&a.founded(F.mapper)){c.call(G,F.url,G,F,{},function(){v(G,F)}).always(function(){L.resolve()})}else{v(G,F);if(!a.toBoolean(F.hidden)&&(a.founded(F.items)||a(G).find("ul:eq(0)").find("li").size()>0)){a(G).show()}else{a(G).hide()}L.resolve()}var M=a(G).find("ul:eq(0)");if(a.defined(F.select)&&a.toBoolean(F.select)){r(F,a(M).find("select.select-xs"),M)}else{if(a.defined(F.dualSelect)&&a.toBoolean(F.dualSelect)){var K=a(M).find("select.select-xs");p(F,K[0],K[1],M)}else{if(a.defined(F.radio)&&a.toBoolean(F.radio)){u(F,M)}else{if(a.defined(F.checkbox)&&a.toBoolean(F.checkbox)){g(F,M)}}}}}))});a.when(D).always(function(){var E=a(q).find("div.condition-row");a(E).last().find(".form-group").removeAttr("style");if(a(E).size()<=2){a(E).last().css({"border-bottom":"solid 1px #a7bdd3"})}else{if(a.toBoolean(y.retractable)&&a(E).size()>2){a(q).append(e.condition_retract.call(k))}}C.resolve()})}})).always(function(){if(b.size()>0||l.size()>0){var E=[{click:function(){y.onSearchClick.call(k,k.getConditions(),k.getMergeConditions())}},{click:function(){this.resetConditions()}}];a.each(E,function(G,F){var H=a(b).find("div.buttons").find("button:eq("+G+")");a.each(F,function(I,J){a(H).unbind(I).bind(I,function(K){J.call(k,K)})});var H=a(l).find("div.buttons").find("button:eq("+G+")");a.each(F,function(I,J){a(H).unbind(I).bind(I,function(K){J.call(k,K)})})})}if(b.size()>0&&a(b).find("input.filter-input").size()>0){a(b).find("input.filter-input").unbind("keydown").bind("keydown",function(G){var F=a.event.fix(G);if(F.keyCode==13){F.preventDefault();y.onSearchClick.call(k,k.getConditions(),k.getMergeConditions())}F.stopPropagation();F.stopImmediatePropagation()})}if(q.size()>0){a.each(y.model,function(H,F){var G=a(q).find("div.items").eq(H);if(!a.founded(F.url)){f(G,F)}})}var D=a(q).find("div.condition-retract");if(D.size()>0){var C=true;a(D[0]).find("a").click(function(F){if(C==true){C=false;a(this).text(z.moreItemBottom);a(this).removeClass("up").addClass("down");a(q).find("div.condition-row").each(function(){a(this).hide()})}else{C=true;a(this).text(z.moreItemUpText);a(this).removeClass("down").addClass("up");a(q).find("div.condition-row").each(function(I,H){var G=y.model[I];a(this).show()})}})}});if(B.find("div.selected").size()>0){B.show()}a(d).find("div.searchbox:eq(0)").show()},setDefaults:function(b){a.extend(a.fn.searchBox.defaults,b)}};a.fn.searchBox=function(c){if(typeof c=="string"){var e=a(this[0]),d=e.data("searchBox");if(!d&&c=="destroy"){return}if(d){var b=a.grep(arguments||[],function(g,f){return f>=1});return d[c].apply(d,[].concat(b||[]))}}else{return this.each(function(){var h=a(this),g=h.data("searchBox");if(!g){var f=a.extend(true,{},a.fn.searchBox.defaults,h.data(),((typeof c=="object"&&c)?c:{}));h.data("searchBox",(g=new a.bootui.widget.SearchBox(this,f)))}})}};a.fn.searchBox.defaults={jsonReader:{root:"items",records:"totalResult"},beforeRender:a.noop,errorRender:a.noop,afterRender:a.noop,onSearchClick:function(b){search("tabGrid",b)},onMoreClick:function(b,c){var d=this;if(!b.gridType){throw new Error("model \u9700\u8981\u4e00\u4e2a gridType \u53c2\u6570\uff01 ")}jQuery.showSelectDialog(b.gridType,a.extend(c,{width:800,height:500,title:b.text+"\u5217\u8868"}),function(f,e){if(jQuery.founded(f)&&jQuery.founded(b.mapper)){var g=[];jQuery.each(f||[],function(l,j){var k=j.key,m=j.text;var h=d.buildItem(b,k,m,j);g.push(h)});d.addSelectedItem(b,g)}if(jQuery.founded(e)){d.removeSelectedItem(b,e)}})},showSize:6,maxSize:100,searchFilter:true,selectedAttr:true,retractable:true,autoSearch:false,filterText:null,filters:[],model:[],paramNames:{page:"queryModel.currentPage",rows:"queryModel.showCount",order:"queryModel.sortOrder",sort:"queryModel.sortName",minNum:"minNum",maxNum:"maxNum"}}})(jQuery);

;(function(a){a.bootui=a.bootui||{};a.bootui.widget=a.bootui.widget||{};a.bootui.widget.messages=a.bootui.widget.messages||{};a.extend(a.bootui.widget.messages,{searchbox:{placeholder:"\u6a21\u7cca\u67e5\u8be2\u6761\u4ef6,\u591a\u4e2a\u503c\u7528\u7a7a\u683c\u9694\u5f00!",queryButtonText:"\u67e5\u8be2",resetButtonText:"\u91cd\u7f6e",allRadioText:"\u5168\u90e8",allSelectText:"\u5168\u90e8",seletedLabelText:"\u5df2\u9009\u6761\u4ef6",toLabelText:"\u81f3",sureButtonText:"\u786e\u5b9a",downLabelText:"\u66f4  \u591a",upLabelText:"\u6536\u8d77",moreItemUpText:"\u6536\u8d77",moreItemBottom:"\u5c55\u5f00"}})})(jQuery);
